<!DOCTYPE html>
<html lang="zh-cn">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta http-equiv="X-UA-Compatible" content="UTF-8">
		<title>聚时光宝盒</title>
		<meta name="keywords" content="">
		<meta name="description" content="">
		<!-- 公共样式 -->
		<link rel="shortcut icon" href="imgs/page-2-logo.png" type="image/x-icon" />
		<link href="https://cdn.bootcss.com/Swiper/4.4.5/css/swiper.min.css" rel="stylesheet">
		<link rel="stylesheet" href="css/animate.css">
		<link rel="stylesheet" type="text/css" href="css/font/fangzhengcujinling.css">
		<link rel="stylesheet" type="text/css" href="css/index.css">
		<script>
			var _hmt = _hmt || [];
			(function() {
			  var hm = document.createElement("script");
			  hm.src = "https://hm.baidu.com/hm.js?c8a7b480d39efdcf7130b9c45637bd6b";
			  var s = document.getElementsByTagName("script")[0]; 
			  s.parentNode.insertBefore(hm, s);
			})();
		</script>		
		<!-- 独立样式 -->
	</head>

	<body>
		<script>
			// 自适应REM
			window.onload = function () {
				getRem(640, 100)
			};
			window.onresize = function () {
				getRem(640, 100)
			};
			getRem(640, 100);

			function getRem(pwidth, prem) {
				var html = document.getElementsByTagName("html")[0];
				var oWidth = document.body.clientWidth || document.documentElement.clientWidth;
				html.style.fontSize = oWidth / pwidth * prem + "px";
			}
		</script>
		<img class="music animated rotatemusic infinite" src="imgs/music.png">
		<audio id="bgm" preload="auto" src="music/bgm.mp3"></audio>
		<section class="page-1">
			<img src="imgs/page-1-bg.jpg" alt="" class="bg">
			<img src="imgs/page-1-xj.png" alt="" class="xj">
			<img src="imgs/page-1-star.png" alt="" class="star-1">
			<img src="imgs/page-1-star.png" alt="" class="star-2">
			<img src="imgs/page-1-star.png" alt="" class="star-3">
			<img src="imgs/page-1-star.png" alt="" class="star-4">
			<img src="imgs/page-1-star.png" alt="" class="star-5">
			<div class="line-box">
				<div class="line js-line" id="percent"></div>
			</div>
		</section>
		<section class="page-2" style="display: none;">
			<div class="rulebox" style="display: none;">
				<img src="imgs/rule.png" alt="" class="rule">
				<img src="imgs/closerule.png" alt="" class="ruleclose">
			</div>
			<img src="imgs/page-2-bg.jpg" alt="" class="bg">
			<img src="imgs/page-2-logo.png" alt="" class="logo">
			<img src="imgs/page-2-biao.png" alt="" class="biao">
			<img src="imgs/page-2-deng.png" alt="" class="deng">
			<img src="imgs/page-2-desk.png" alt="" class="desk">
			<img src="imgs/page-2-frj.png" alt="" class="frj">
			<img src="imgs/page-2-lyj.png" alt="" class="lyj">
			<img src="imgs/page-2-tv.png" alt="" class="tv">
			<img src="imgs/page-2-xj.gif" alt="" class="xj">
			<img src="imgs/page-2-xj-t.png" alt="" class="xj-t">
			<div class="book-box">
				<img src="imgs/page-2-book.png" alt="" class="book">
				<div class="relative">
					<img src="imgs/page-2-text-1.png" alt="" class="text-1 text-all text_op">
					<img src="imgs/page-2-text-2.png" alt="" class="text-2 text-all text_op">
					<img src="imgs/page-2-text-3.png" alt="" class="text-3 text-all text_op">
					<img src="imgs/page-2-text-4.png" alt="" class="text-4 text-all text_op">
					<img src="imgs/page-2-text-5.png" alt="" class="text-5 text-all text_op">
					<img src="imgs/page-2-text-6.png" alt="" class="text-6 text-all text_op">
					<img src="imgs/page-2-text-7.png" alt="" class="text-7 text-all text_op">
					<img src="imgs/page-2-text-8.png" alt="" class="text-8 text-all text_op">
					<img src="imgs/page-2-text-9.png" alt="" class="text-9 text-all text_op">
					<img src="imgs/page-2-text-10.png" alt="" class="text-10 text-all text_op">
					<img src="imgs/page-2-text-11.png" alt="" class="text-11 text-all text_op">
					<img src="imgs/page-2-text-12.png" alt="" class="text-12 text-all text_op">
					<img src="imgs/page-2-text-13.png" alt="" class="text-13 text-all text_op">
				</div>
			</div>
			<input id="taokouling" class="tkl" value="1234567890"/>
			<img src="imgs/page-2-cover.png" alt="" class="cover">
			<img src="imgs/copy.png" alt="" id="copybtn" class="thanks js-thanks" data-clipboard-target="#taokouling">
			<div class="text-box js-text-box input-name">
				<img src="imgs/page-2-box-bg.png" alt="" class="box-bg">
				<input type="text" placeholder="输入姓名" id="name" maxlength="4">
			</div>
			<div class="text-box js-text-box input-time">
				<img src="imgs/page-2-box-bg.png" alt="" class="box-bg">
				<div>请选择出生年份</div>
				<input style="opacity: 0;" type="date" id="time">
			</div>
			<div class="text-box button bg_scale js-go-page-3">
				<img src="imgs/page-2-box-bg.png" alt="" class="box-bg">
				<img src="imgs/page-2-button.png" alt="" class="text">
			</div>
		</section>
		<section class="page-3" style="display: none;">
			<img src="imgs/page-3-bg.jpg" alt="" class="bg">
			<div class="tv-box">
				<div class="relative">
					<div class="swiper-container">
						<div class="swiper-wrapper" id="swiper">

						</div>
					</div>
					<img src="imgs/page-3-tv.png" alt="" class="tv">
				</div>
			</div>
			<!-- 如果需要导航按钮 -->
			<div class="swiper-button-prev animated tada infinite"></div>
			<div class="swiper-button-next animated tada infinite"></div>
			<img class="onekey" src="imgs/onekey.png" />
			<!-- 遥控器	 -->
			<div class="yk-box">
				<div class="relative">
					<!-- <img src="imgs/page-3-yk.png" alt="" class="yk yk-up"> -->
					<!-- <img class=" put-box" src="imgs/btnpress.png" /> -->
					<img src="imgs/page-3-yk-down.png" alt="" class="yk yk-down js-yk-down">
					<img class="js-put-box put-box" src="imgs/btn.png" / style="display: none">
					<img src="imgs/press.gif" alt="" class="press_gif active">
				</div>
			</div>
			<div class="button-box timebox js-timebox">
				<img src="imgs/page-3-my.png" alt="" class="button-img">
				<div class="dot js-dot">0</div>
			</div>
			<div class="button-box call js-call">
				<img src="imgs/page-3-call.png" alt="" class="button-img">
			</div>
			<!-- 分享 -->
			<div class="fenxiang js-fenxiang">
				<div class="relative">
					<img src="imgs/fenxiang.png" alt="">
				</div>
			</div>
		</section>
		<section class="page-4" style="display: none;">
			<img src="imgs/page-2-bg.jpg" alt="" class="bg">
			<div class="paper-box">
				<img src="imgs/page-4-paper.png" alt="" class="paper-img">
				<img src="imgs/page-4-have.png" alt="" class="have js-have">
				<img src="imgs/page-4-again.png" alt="" class="again js-again">
				<div class="list-box js-list-box">

				</div>
			</div>
		</section>
		<section class="page-5" style="display: none;">
			<img src="imgs/page-1-bg.jpg" alt="" class="bg">
			<img src="imgs/page-5-line.png" alt="" class="line">
			<div class="a box">
				<div class="box-c">
					<img src="imgs/page-5-a.png" alt="">
				</div>
			</div>
			<div class="b box">
				<div class="box-c">
					<img src="imgs/page-5-b.png" alt="">
				</div>
			</div>
			<div class="c box">
				<div class="box-c">
					<img src="imgs/page-5-c.png" alt="">
				</div>
			</div>
			<div class="d box">
				<div class="box-c">
					<img src="imgs/page-5-d.png" alt="">
				</div>
			</div>
			<div class="e box">
				<div class="box-c">
					<img src="imgs/page-5-e.png" alt="">
				</div>
			</div>
			<div class="f box">
				<div class="box-c">
					<img src="imgs/page-5-f.png" alt="">
				</div>
			</div>
			<div class="g box">
				<div class="box-c">
					<img src="imgs/page-5-g.png" alt="">
				</div>
			</div>
			<div class="h box">
				<div class="box-c">
					<img src="imgs/page-5-h.png" alt="">
				</div>
			</div>
			<div class="i box">
				<div class="box-c">
					<img src="imgs/page-5-i.png" alt="">
				</div>
			</div>
			<img src="imgs/page-5-text.gif.gif" alt="" class="loading animated fadeOut du1000 delay1500">
			<img src="imgs/textttt.png" alt="" class="text animated zoomIn du1000 delay2000">
			<img src="imgs/search.png" alt="" class="search animated fadeIn delay6000">
		</section>
		<section class="page-6" style="display: none;">
			<img src="imgs/page-2-bg.jpg" alt="" class="bg">
			<div class="canvas" id="canvas-box">
				<div class="relative">
					<div class="js-canvas">
						<div id="canvas"></div>
						<div class="longpress"><img src="imgs/longpress.png" alt=""></div>
					</div>
				</div>
			</div>
		</section>
		<!-- 公共JS -->
		<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
		<script src="https://cdn.bootcss.com/Swiper/4.4.5/js/swiper.min.js"></script>
		<script src="js/swiper.animate1.0.3.min.js"></script>
		<script src="https://cdn.bootcss.com/lettering.js/0.7.0/jquery.lettering.min.js"></script>
		<script src="https://cdn.bootcss.com/textillate/0.4.0/jquery.textillate.min.js"></script>
		<script src="https://cdn.bootcss.com/layer/2.3/layer.js"></script>
		<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
		<script src="js/share.js?v=11"></script>
		<!-- 独立JS -->
		<script>
			var clipboard = new ClipboardJS('#copybtn');
      clipboard.on("success", function(e){
        layer.msg('淘口令已复制');
      });
			var hh = document.body.clientHeight
			$("input").on("blur", function() {
				document.body.scrollTop = 0
				document.body.style.height = hh
			})
			// ----------第一页-----------
			var texts = ""

			function quchong2(str) {
				var newStr = "";
				for (var i = 0; i < str.length; i++) {
					if (newStr.indexOf(str[i]) == -1) {
						newStr += str[i];
					}
				}
				return newStr;
			}
			$.ajax({
				url: 'https://html5.bjsidao.com/api/Face/getImgList',
				type: 'post',
				data: {

				},
				success: function(res) {
					for (var i = 0; i < res.length; i++) {
						var list_text = res[i].text
						var list_id = res[i].id
						var list_img = res[i].imgurl
						html = '<div class="swiper-slide">\
																	<img src="' + list_img + '" alt="" data-id="' + list_id +
							'">\
																	<div class="text tlt_swiper">' + list_text + '</div>\
																</div>'
						$("#swiper").append(html)
						texts += list_text
					}
					texts += "输入名字请选择出生年份月日"
					console.log(quchong2(texts))
					console.log(res);
					perFun();
				},
				error: function(data) {
					console.log('请求超时');
					// alert("dddddd")
				}
			})
			// 加载
			function perFun() {

				var imgs = document.getElementsByTagName("img");
				var len = 0;
				var percent = document.getElementById("percent");
				var imgLength = imgs.length - 1
				for (var i = 0; i < imgs.length; i++) {
					if (imgs[i].complete) {
						len++;
						document.getElementById("percent").style.width = Math.round(len * 100 / imgs.length) + "%"
						console.log(len)
						// 跳转到第二页
						if (len == imgLength) {
							$(".page-1").fadeOut(0)
							$(".page-2").fadeIn(300)
							$(".music").css({
								opacity: '1',
							});
						}
					} else {
						imgs[i].onload = function() {
							len++;
							document.getElementById("percent").style.width = Math.round(len * 100 / imgs.length) + "%"
							// console.log(len)
							// 跳转到第二页
							if (len == imgLength) {
								$(".page-1").fadeOut(0)
								$(".page-2").fadeIn(300)
								$(".music").css({
									opacity: '1',
								});
							}
						}
					}
				}
			}
			audioAutoPlay();
			$(function() {
				audioAutoPlay();
			})

			function audioAutoPlay() {
				var audio = document.getElementById('bgm');
				audio.play();
				document.addEventListener("WeixinJSBridgeReady", function() {
					audio.play();
				}, false);
				audio.onended = function() {
					audio.currentTime = 0
					audio.play();
				}
			}
			$(".music").click(function() {
				var audio = document.getElementById('bgm');
				if (audio.paused) {
					audio.play();
					$(this).addClass('rotatemusic');
				} else {
					audio.pause();
					$(this).removeClass('rotatemusic');
				}
			});
			// -----------第二页----------	
			$(".ruleclose").click(function() {
				$(".rulebox").fadeOut(300)
			})
			// 选择出生年
			$("#time").on("change", function() {
				$(this).css("opacity", "1");
				$(this).prev().hide();
			})
			// 进去第七页
			$(".js-thanks").click(function() {
				//淘口令
			})
			// 进入第三页
			// 轮播文字动画
			var name
			var time
			$(".js-go-page-3").click(function() {
				name = $("#name").val()
				time = $("#time").val()
				if (name.length == 0) {
					layer.msg('请输入姓名');
					$("#name").focus()
				} else if (time.length == 0) {
					layer.msg('请选择出生年份');
				} else {
					$(".page-2").fadeOut(0)
					$(".page-3").fadeIn(300)
					layer.tips('八表：八方以外极远的地方。泛指天地之间。', '#1', {
				        tips: [1, '#ffcc99'],
					time: 20000
					});
					layer.msg('聚时光宝盒不能少于3件物品也不能多于5件哦',{time : 1200,}); 
					setTimeout(function() {
						$(".onekey").fadeIn(300)
					}, 1300)
					setTimeout(function() {
						$(".yk-box").fadeIn(300)
					}, 1500)	
					setTimeout(function() {
						$(".page-3 .swiper-button-next, .swiper-container-rtl .swiper-button-prev").fadeIn(300)
					}, 1800)						
					setTimeout(function() {
						$(".page-3 .swiper-button-prev, .swiper-container-rtl .swiper-button-next").fadeIn(300)
					}, 18800)		
					setTimeout(function() {
						$(".tv-box").fadeIn(300)
						swiper()
					}, 1800)																			
					$(".page-3").click(function() {
						$(".onekey").fadeOut(500)
					});
				}
			});

			function swiper() {
				// 轮播
				var mySwiper = new Swiper('.swiper-container', {
					loop: true, // 循环模式选项
					// 如果需要前进后退按钮
					navigation: {
						nextEl: '.swiper-button-next',
						prevEl: '.swiper-button-prev',
					},
					on: {
						init: $('.tlt_swiper').textillate({ in: {
								effect: 'fadeIn',
								delay: 50
							}
						}),
						slideChangeTransitionStart: function() {
							$('.tlt_swiper').textillate('in')
						}
					},
				})
			}
			// -------------第三页----------- 
			// 置入宝盒
			var arr_list = []
			var arr_list_id = []
			// 传给后台的id
			var list_id_arr
			var bas_img
			$(".yk-box .relative").click(function() {
				console.log('ss');
				var that = this
				if ($(".press_gif").hasClass('active')) {
					$(".press_gif").removeClass('active')
					$(".press_gif").fadeOut(0)
				}
				$(that).find(".js-put-box").fadeOut(0)
				// $(that).attr("src", "imgs/btnpress.png")
				setTimeout(function() {
					// $(that).attr("src", "imgs/btn.png")
					$(that).find(".js-put-box").fadeIn(0)
				}, 300);
				var content_id = $(".swiper-slide-active img").attr("data-id")
				if (arr_list_id.indexOf(content_id) > -1) {
					return
				}
				var content = {
					src: $(".swiper-slide-active img").attr("src"),
					text: $(".swiper-slide-active .text .texts").text()
				}
				arr_list.push(content)
				$(".js-dot").text(arr_list.length)
				arr_list_id.push(content_id)
				console.log(arr_list);
				console.log(arr_list_id);
			});


			// 邀请朋友
			$(".js-call").click(function() {
				$(this).parent().find('.js-fenxiang').fadeIn(300)
				console.log(name);
				console.log(time);
			});
			$(".js-fenxiang").click(function() {
				$(this).fadeOut(400)
			})
			// 进入第四页
			var upload_src;
			$(".js-timebox").click(function() {
				appFun()
				$(".page-3").fadeOut(0)
				$(".page-4").fadeIn(300)
				console.log(name);
				console.log(time);
				console.log(arr_list);
				$(".js-delect").click(function() {
					var id = $(".js-delect").index(this)
					arr_list.splice(id, 1)
					arr_list_id.splice(id, 1)
					console.log(arr_list_id);
					$(this).parent().remove()
				})
				$(".js-delect-1").click(function() {
					$(".inputHave").css({
						opacity: '0',
					});
					$('#img_preview').get(0).src = "";
					bas_img = undefined;
					$('#zx_img').val("")
					$("#yourstory").val("")
				})
				//在input file内容改变的时候触发事件
				$('#zx_img').change(function() {
					//获取input file的files文件数组;
					//$('#filed')获取的是jQuery对象，.get(0)转为原生对象;
					//这边默认只能选一个，但是存放形式仍然是数组，所以取第一个元素使用[0];
					var file = $('#zx_img').get(0).files[0];
					//创建用来读取此文件的对象
					var reader = new FileReader();
					//使用该对象读取file文件
					reader.readAsDataURL(file);
					//读取文件成功后执行的方法函数
					reader.onload = function(e) {
						//读取成功后返回的一个参数e，整个的一个进度事件
						console.log(e);
						//选择所要显示图片的img，要赋值给img的src就是e中target下result里面
						bas_img = e.target.result
						console.log(bas_img);
						//的base64编码格式的地址
						$(".inputHave").css({
							opacity: '1',
						});
						$('#img_preview').get(0).src = e.target.result;
					}
				})
			})
			var myContent_text = ""
			function appFun() {
				$(".js-list-box").html("")
				var addHtml =
					' <div class="list">\
						<img src="imgs/page-4-x.png" alt="" class="delect js-delect-1">\
						<img src="imgs/page-4-text-bg.png" alt="" class="text-bg">\
						<img src="imgs/page-4-add-img.png" alt="" class="content-img">\
						<div class="inputHave"><img src="" data-src="" id="img_preview"  class="inputHaveImg" data-holder-rendered="true"></div>\
						<input type="file" name="file" accept="image/*" class="inputimg" id="zx_img"/> \
						<input id="yourstory" type="text" placeholder="输入你的故事" maxlength="15" class="inputtext">\
					</div>'
				for (var i = 0; i < arr_list.length; i++) {
					var img_src = arr_list[i].src
					var img_text = arr_list[i].text
					html =
						' <div class="list">\
							<img src="imgs/page-4-x.png" alt="" class="delect js-delect">\
							<img src="imgs/page-4-text-bg.png" alt="" class="text-bg">\
							<img src="' +
						img_src + '" alt="" class="content-img">\
							<div class="text">' + img_text + '</div>\
						</div>'
					$(".js-list-box").append(html)
				}
				$(".js-list-box").append(addHtml)
				if(typeof(bas_img) != "undefined"){
					$(".inputHave").css({
						opacity: '1',
					});
					$('#img_preview').get(0).src = bas_img;
				}
				if(myContent_text!=""){
					$("#yourstory").val(myContent_text)
				}
				$("#yourstory").on("blur", function() {
					document.body.scrollTop = 0
					document.body.style.height = hh
					myContent_text = $(this).val()
				})
			}

			// ------------------第四页------------
			// 再次拥有
			$(".js-again").click(function() {
				$(".page-4").fadeOut(0)
				$(".page-3").fadeIn(300)
				$(".js-dot").text(arr_list.length)
				$('.tlt_swiper').textillate('in')
			});
			$(".js-have").click(function() {
				myContent_text = $("#yourstory").val()
				var alllistlength = typeof(bas_img) == "undefined" ? arr_list_id.length : arr_list_id.length + 1;
				if (typeof(bas_img) != "undefined" && myContent_text == "") {
					layer.msg("请输入你的故事")
					return
				}
				if (alllistlength > 5 || alllistlength < 3) {
					layer.msg("聚时光宝盒不能少于3件物品也不能多于5件哦")
					return
				}
				var data = typeof(bas_img) == "undefined" ? {
					name: name,
					birth: time,
					imgs: list_id_arr
				} : {
					name: name,
					birth: time,
					imgs: list_id_arr,
					user_img: bas_img,
					user_text: myContent_text
				}
				// console.log(name);
				// console.log(time);
				// console.log(arr_list);
				var myContent = {
					src: $("#img_preview").attr("src"),
					text: $(".inputtext").val()
				}
				if ($("#img_preview").attr("src") != '' || $(".inputtext").val() != '') {
					arr_list.push(myContent)
					console.log(arr_list);
				}
				$(".page-4").fadeOut(0)
				$(".page-5").fadeIn(300)
				setTimeout(function () {
					$(".page-5 .text").fadeOut(1000)
				},2000)
				list_id_arr = arr_list_id.toString()
				$.ajax({
					url: 'https://html5.bjsidao.com/api/Face/image',
					type: 'post',
					data: {
						name: name,
						birth: time,
						imgs: list_id_arr,
						user_img: bas_img,
						user_text: myContent_text
					},
					success: function(res) {
						var html_img = '<img src="' + res.imgurl + '" alt="">'
						$("#canvas-box").append(html_img)
						$("#canvas").append(html_img)
						console.log(res);
						setTimeout(function() {
							$(".page-5").fadeOut(0)
							$(".page-6").fadeIn(300)
						}, 3500);
					},
					error: function(data) {
						console.log('请求超时');
						// alert("dddddd")
					}
				})
			})
		</script>
	</body>
</html>
